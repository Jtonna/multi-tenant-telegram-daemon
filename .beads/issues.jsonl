{"id":"multi-tenant-telegram-daemon-0rk","title":"Phase 4: Integration (end-to-end)","status":"closed","priority":2,"issue_type":"epic","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-09T13:27:40.795331-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-26T10:34:02.6455155-08:00","closed_at":"2026-02-26T10:34:02.6455155-08:00","close_reason":"Duplicate of son"}
{"id":"multi-tenant-telegram-daemon-26c","title":"Phase 2: Chat Router System","status":"closed","priority":2,"issue_type":"epic","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-09T13:27:28.0212349-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-26T10:11:09.2228595-08:00","closed_at":"2026-02-26T10:11:09.2228595-08:00","close_reason":"Phase 2 complete: SQLite, CLI, WebSocket, Telegram wiring, tests, docs"}
{"id":"multi-tenant-telegram-daemon-2pw","title":"Replace JSON store with SQLite persistence","description":"Rewrite chat-router/src/db/store.ts to use better-sqlite3. Same public method signatures so service.ts and api/ stay untouched. Schema: timeline and conversations tables with proper indexes. ingestTransaction becomes a real SQLite transaction. :memory: mode still works for tests. All 33 existing tests must pass.","status":"closed","priority":1,"issue_type":"task","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-11T08:05:11.5151817-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-11T08:32:10.7915667-08:00","closed_at":"2026-02-11T08:32:10.7915667-08:00","close_reason":"SQLite persistence implemented with better-sqlite3, all 33 tests pass"}
{"id":"multi-tenant-telegram-daemon-2sl","title":"Phase 1: Telegram Plugin (standalone)","status":"closed","priority":1,"issue_type":"epic","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-09T13:21:58.4821722-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-11T08:05:05.3854991-08:00","closed_at":"2026-02-11T08:05:05.3854991-08:00","close_reason":"Phase 1 complete: grammY bot receives messages, sends responses with splitting, forwards to chat router"}
{"id":"multi-tenant-telegram-daemon-3ow","title":"Telegram plugin + chat router: return leg, reactions, logging, ACS auto-trigger","description":"Expanded scope from original WebSocket return leg to include full round-trip integration:\n\n1. WebSocket return leg — plugin listens for outbound messages and delivers to Telegram (original scope)\n2. Thumbs-up reaction — bot reacts with thumbs-up after successful chat router ingestion + ACS trigger\n3. Request logging middleware — chat router logs all HTTP requests/responses\n4. File logging — both chat router and telegram plugin tee console output to log files\n5. ACS auto-trigger — chat router triggers ACS job on inbound messages (POST /api/messages awaits trigger before returning 201)\n6. dotenv support — chat router reads .env for ACS_JOB_NAME config\n7. .env.example files — sample configuration for both packages","status":"closed","priority":2,"issue_type":"feature","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-26T12:28:28.8097323-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-27T06:17:01.6586969-08:00","closed_at":"2026-02-27T06:17:01.6586969-08:00","close_reason":"Implemented WebSocket return leg, thumbs-up reactions, request/file logging for both servers, ACS auto-trigger integration, dotenv support, and .env.example files. All 56 chat-router tests pass. Documentation updated across 5 files.","comments":[{"id":2,"issue_id":"multi-tenant-telegram-daemon-3ow","author":"Jacob Tonna","text":"Approved plan: (1) Install ws + @types/ws. (2) Create wsClient.ts — WS client with filtering, delivery via bot.api.sendMessage, splitMessage, basic reconnect. (3) Integrate into index.ts — connect on startup, disconnect on shutdown. (4) Unit tests for wsClient. Tasks 3+4 parallel after 2.","created_at":"2026-02-26T20:36:41Z"},{"id":3,"issue_id":"multi-tenant-telegram-daemon-3ow","author":"Jacob Tonna","text":"Scope expanded: original ticket was just WebSocket return leg (already committed). Added thumbs-up reactions, request/file logging for both servers, and ACS auto-trigger integration. The ACS trigger fires inline in POST /api/messages so the plugin's thumbs-up confirms the agent job was kicked off, not just that the message was stored. All 56 tests still pass. No client-specific config in tracked files — tenant config lives in .env (gitignored).","created_at":"2026-02-27T13:54:59Z"}]}
{"id":"multi-tenant-telegram-daemon-3qo","title":"Multi-line messages drop content after newline — search requirements lost","description":"When a Telegram message contains contact info on the first line and search requirements on a subsequent line (separated by a newline), the search requirements are dropped before reaching ACS. Observed in the Jacob Tonna interaction at 22:12:30 UTC — the ADU/guest suite requirements and verification note on the second paragraph were not forwarded. Root cause is unknown: could be in the Telegram plugin message forwarding or in the chat router message handling. Investigate both paths.","status":"open","priority":2,"issue_type":"bug","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-27T14:21:49.986308-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-27T14:21:49.986308-08:00"}
{"id":"multi-tenant-telegram-daemon-4gz","title":"Telegram bot access control: DM allowlist + group allowlist","description":"Security hardening for the Telegram plugin. Bot is locked down by default — no messages are forwarded or processed. A /config command (always accessible) replies with the caller's Telegram user ID and, if in a group, the group chat ID. The operator copies these IDs into .env to allowlist them. Config via TELEGRAM_ALLOWED_USER_IDS and TELEGRAM_ALLOWED_GROUP_IDS in .env (comma-separated). Includes comments in .env.example explaining the workflow.","status":"closed","priority":2,"issue_type":"feature","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-27T10:27:06.3687075-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-27T10:58:29.667978-08:00","closed_at":"2026-02-27T10:58:29.667978-08:00","close_reason":"Implemented default-deny access control with allowlists for DMs (user IDs) and groups (chat IDs), /config command for ID discovery, 17 new tests, docs updated."}
{"id":"multi-tenant-telegram-daemon-6m4","title":"Hack: agent response-via-API instruction file","description":"Create how_to_respond_to_user.xml in glue/narwalestates that instructs Kevan to POST responses back to the chat router via curl. Update narwalestates CLAUDE.md to register the new capability. Proof-of-concept for the Telegram → Chat Router → ACS → Kevan → Chat Router → Telegram round-trip.","status":"closed","priority":2,"issue_type":"task","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-26T11:11:19.1788104-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-26T11:23:43.7514556-08:00","closed_at":"2026-02-26T11:23:43.7514556-08:00","close_reason":"Created how_to_respond_to_user.xml and updated CLAUDE.md in glue/narwalestates to instruct Kevan to POST responses to chat router via curl. POC for Telegram round-trip integration.","comments":[{"id":1,"issue_id":"multi-tenant-telegram-daemon-6m4","author":"Jacob Tonna","text":"Approved plan: (1) Create how_to_respond_to_user.xml — lean instruction file for Kevan to POST responses to chat router via curl. Sections: overview, prompt variables, curl template, multi-message, error handling, rules. (2) Update CLAUDE.md — register respond capability. Both rated light. Sub-task 2 depends on sub-task 1.","created_at":"2026-02-26T19:18:29Z"}]}
{"id":"multi-tenant-telegram-daemon-7n9","title":"Set up grammY Telegram bot and receive messages","description":"Scaffold the telegram plugin package, configure grammY, connect to a real Telegram bot, and verify we can receive DM messages. Log the raw message data to understand the shape.","status":"closed","priority":1,"issue_type":"task","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-09T13:27:49.5257285-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-09T14:53:35.9626681-08:00","closed_at":"2026-02-09T14:53:35.9626681-08:00","close_reason":"Closed","dependencies":[{"issue_id":"multi-tenant-telegram-daemon-7n9","depends_on_id":"multi-tenant-telegram-daemon-2sl","type":"blocks","created_at":"2026-02-09T13:28:19.3932552-08:00","created_by":"Jacob Tonna"}]}
{"id":"multi-tenant-telegram-daemon-boq","title":"Daemon CLI adapter","description":"Chat router executable detects CLI flags vs daemon mode. CLI mode sends commands to running daemon over HTTP (reuses REST API). Commands: ingest, respond, timeline, conversations, health. Minimal arg parsing. New files: chat-router/src/cli/adapter.ts, chat-router/src/cli/client.ts. Update index.ts for mode detection.","status":"closed","priority":1,"issue_type":"feature","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-11T08:05:15.1660698-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-26T10:10:48.2012569-08:00","closed_at":"2026-02-26T10:10:48.2012569-08:00","close_reason":"CLI adapter implemented: mode detection, 5 commands, HTTP client reusing REST API","dependencies":[{"issue_id":"multi-tenant-telegram-daemon-boq","depends_on_id":"multi-tenant-telegram-daemon-2pw","type":"blocks","created_at":"2026-02-11T08:05:28.8281383-08:00","created_by":"Jacob Tonna"}]}
{"id":"multi-tenant-telegram-daemon-fqm","title":"WebSocket adapter","description":"Add ws library. Create chat-router/src/ws/adapter.ts attached to existing HTTP server on /ws path. JSON message protocol with request/response + server push on new message ingestion. Add event emission to service (EventEmitter). New files: ws/adapter.ts, ws/protocol.ts. Wire into index.ts.","status":"closed","priority":2,"issue_type":"feature","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-11T08:05:17.2235962-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-26T10:10:53.4547849-08:00","closed_at":"2026-02-26T10:10:53.4547849-08:00","close_reason":"WebSocket adapter implemented: /ws path, JSON protocol, real-time push via EventEmitter","dependencies":[{"issue_id":"multi-tenant-telegram-daemon-fqm","depends_on_id":"multi-tenant-telegram-daemon-2pw","type":"blocks","created_at":"2026-02-11T08:05:30.7463298-08:00","created_by":"Jacob Tonna"}]}
{"id":"multi-tenant-telegram-daemon-ggi","title":"Send responses back to Telegram","description":"Implement sending responses back to the user via Telegram. Handle message splitting for \u003e4096 chars. Expose via a simple CLI command or API call for manual testing.","status":"closed","priority":1,"issue_type":"task","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-09T13:27:58.1818636-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-09T14:53:36.2859939-08:00","closed_at":"2026-02-09T14:53:36.2859939-08:00","close_reason":"Closed","dependencies":[{"issue_id":"multi-tenant-telegram-daemon-ggi","depends_on_id":"multi-tenant-telegram-daemon-7n9","type":"blocks","created_at":"2026-02-09T13:30:03.0273114-08:00","created_by":"Jacob Tonna"}]}
{"id":"multi-tenant-telegram-daemon-gmp","title":"Convert Telegram plugin to daemon process","description":"Wire the Telegram plugin to communicate with the chat router via daemon CLI (or continue using HTTP since the CLI wraps REST). Add startup health check to telegram-integration/src/index.ts — check chat router is reachable before starting bot, log warning if not. Verify end-to-end: fake messages from plugin reach SQLite. Update docs in docs/chat-router-plugin/.","status":"closed","priority":1,"issue_type":"task","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-09T13:28:06.6410995-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-26T10:10:58.7119072-08:00","closed_at":"2026-02-26T10:10:58.7119072-08:00","close_reason":"Telegram plugin wired: startup health check, warn-but-don't-block pattern","dependencies":[{"issue_id":"multi-tenant-telegram-daemon-gmp","depends_on_id":"multi-tenant-telegram-daemon-ggi","type":"blocks","created_at":"2026-02-09T13:30:03.3274755-08:00","created_by":"Jacob Tonna"},{"issue_id":"multi-tenant-telegram-daemon-gmp","depends_on_id":"multi-tenant-telegram-daemon-boq","type":"blocks","created_at":"2026-02-11T08:05:45.2911379-08:00","created_by":"Jacob Tonna"}]}
{"id":"multi-tenant-telegram-daemon-iq3","title":"Phase 3: Boilerplate Plugin","description":"Plugin template extracted from Telegram plugin patterns. Defines the contract any plugin must follow to talk to the chat router. Reference implementation for future plugins (Discord, Slack, etc.).","status":"open","priority":2,"issue_type":"epic","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-26T10:28:41.9456502-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-26T10:28:41.9456502-08:00"}
{"id":"multi-tenant-telegram-daemon-ivd","title":"Unit tests for Phase 2 code","description":"Tests for each new Phase 2 component: SQLite store (persistence across close/reopen, atomic transaction rollback, all 33 existing tests pass), CLI adapter (argument parsing, command dispatch, error handling), WebSocket adapter (connect/disconnect, command round-trip, push notifications, malformed messages).","status":"closed","priority":1,"issue_type":"task","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-11T08:05:19.197614-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-26T10:11:03.9683828-08:00","closed_at":"2026-02-26T10:11:03.9683828-08:00","close_reason":"56 tests across 5 files covering store, service, API, CLI, and WebSocket","dependencies":[{"issue_id":"multi-tenant-telegram-daemon-ivd","depends_on_id":"multi-tenant-telegram-daemon-2pw","type":"blocks","created_at":"2026-02-11T08:05:32.601883-08:00","created_by":"Jacob Tonna"},{"issue_id":"multi-tenant-telegram-daemon-ivd","depends_on_id":"multi-tenant-telegram-daemon-boq","type":"blocks","created_at":"2026-02-11T08:05:34.4959534-08:00","created_by":"Jacob Tonna"},{"issue_id":"multi-tenant-telegram-daemon-ivd","depends_on_id":"multi-tenant-telegram-daemon-fqm","type":"blocks","created_at":"2026-02-11T08:05:36.3452754-08:00","created_by":"Jacob Tonna"}]}
{"id":"multi-tenant-telegram-daemon-jyt","title":"Phase 3: Boilerplate Plugin","status":"closed","priority":2,"issue_type":"epic","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-09T13:27:34.4413739-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-26T10:33:59.7131065-08:00","closed_at":"2026-02-26T10:33:59.7131065-08:00","close_reason":"Duplicate of iq3"}
{"id":"multi-tenant-telegram-daemon-son","title":"Phase 4: Integration (end-to-end)","description":"Telegram plugin talks to chat router via daemon CLI. Chat router forwards to ACS, routes responses back. End-to-end: Telegram message → plugin → router → ACS → router → plugin → Telegram reply. Dependency: ACS ENH-001 (dynamic trigger parameters).","status":"open","priority":2,"issue_type":"epic","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-26T10:28:43.4486128-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-26T10:28:43.4486128-08:00"}
{"id":"multi-tenant-telegram-daemon-v8j","title":"Seed script + manual integration testing","description":"Create chat-router/src/scripts/seed.ts that inserts 5-10 fake InboundMessages and 2-3 OutboundMessages via the service layer against a SQLite file. Create chat-router/src/scripts/query.ts that hits REST API endpoints (health, conversations, timeline) and prints results. Add npm run seed and npm run query scripts to package.json.","status":"closed","priority":1,"issue_type":"task","owner":"34466548+Jtonna@users.noreply.github.com","created_at":"2026-02-11T08:05:13.3346977-08:00","created_by":"Jacob Tonna","updated_at":"2026-02-11T08:32:11.0625439-08:00","closed_at":"2026-02-11T08:32:11.0625439-08:00","close_reason":"Seed and query scripts created for manual integration testing","dependencies":[{"issue_id":"multi-tenant-telegram-daemon-v8j","depends_on_id":"multi-tenant-telegram-daemon-2pw","type":"blocks","created_at":"2026-02-11T08:05:26.8967949-08:00","created_by":"Jacob Tonna"}]}
